<div class="top">
    <div class="title">
        <h2><?= $this->t('image_picker') ?></h2>
        <span onclick="ImageDialog.close()">
            <?= $this->include('icons/x.svg') ?>
        </span>
    </div>
    <div class="header">
        <div id="image-dialog-file-form">
            <button type="button" class="light" onclick="ImageDialog.close(); ImageDialog.clearImage();"><?= $this->t('remove_image') ?></button>
            <button type="button" id="image-dialog-file-button" onclick="get('#image-input-file').click()" <?php if (!\Aurora\App\Permission::can('edit_media')): ?> disabled <?php endif ?>><?= $this->include('icons/upload_file.svg') ?></button>
            <input type="hidden" name="csrf" value="<?= e($this->csrfToken()) ?>"/>
            <input
                id="image-input-file"
                type="file"
                class="hidden"
                name="file"
                accept="image/*"
                oninput="let path = <?= e(js($path)) ?>; Form.send(`/admin/media/upload?path=${path}`, 'image-dialog-file-form', get('#image-dialog-file-button')).then(() => ImageDialog.setImagePage(path));"
            />
        </div>
    </div>
</div>
<div id="image-dialog-listing" class="listing">
    <div class="listing-row header">
        <div class="w100"></div>
        <div class="w20" title="<?= $this->t('information') ?>"><?= $this->t('information') ?></div>
        <div class="w20" title="<?= $this->t('last_modification') ?>"><?= $this->t('last_modification') ?></div>
    </div>
    <?php foreach ($files as $i => $file): ?>
        <?php $file_path = '/' . \Aurora\Core\Kernel::config('content') . '/' . trim($file['path'], '/') ?>
        <div
            class="listing-row file"
            <?php if ($file['is_file']): ?>
                onclick="ImageDialog.close(); ImageDialog.setImage(<?= e(js($file['path'])) ?>);"
            <?php else: ?>
                onclick="ImageDialog.setImagePage(<?= e(js($file_path)) ?>)"
            <?php endif ?>
        >
            <div class="w100 align-center">
                <?php if ($file['is_file']): ?>
                    <a href="<?= e($file_path) ?>" target="_blank" class="pointer" onclick="event.stopPropagation()">
                        <img src="<?= e($file_path) ?>"/>
                    </a>
                <?php else: ?>
                    <a href="#" class="pointer custom-media folder">
                        <?= $this->include('icons/folder-fill.svg') ?>
                    </a>
                <?php endif ?>
                <span class="file-name"><?= e($file['name']) ?></span>
            </div>
            <div class="w20 file-info">
                <?php if ($file['is_file']): ?>
                    <p><?= e(\Aurora\Core\Helper::getByteSize($file['size'])) ?></p>
                <?php endif ?>
                <p><?= e($file['mime']) ?></p>
            </div>
            <div class="w20">
                <?= e($this->dateFormat($file['time'])) ?>
            </div>
        </div>
    <?php endforeach ?>
    <?php if (empty($files)): ?>
        <span class="empty"><?= $this->t('no_items') ?></span>
    <?php endif ?>
</div>
<div class="media-paths-container">
    <div class="media-paths">
        <?= $this->include('icons/folder.svg') ?>
        <?php $folders = explode('/', trim($path, '/')) ?>
        <?php foreach ($folders as $i => $folder): ?>
            <?php $folder_path = implode('/', array_slice($folders, 0, $i + 1)) ?>
            <?php if (\Aurora\App\Media::isValidPath(\Aurora\Core\Helper::getPath($folder_path))): ?>
                <a href="#" class="pointer" onclick="ImageDialog.setImagePage(<?= e(js($folder_path)) ?>)"><?= e($folder) ?></a>
                <span>/</span>
            <?php endif ?>
        <?php endforeach ?>
    </div>
</div>
